<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script> 
<script type = "text/javascript" >
window.onload = function () {
	var dataPoints = [{y : 0}];
	var chart = new CanvasJS.Chart("chartContainer", {
			title : { text : "Dynamic Data" },
			data : [{ type : "spline",
					  dataPoints : dataPoints }],
            axisY : { maximum : 150  }
		});
	
    chart.render();
	var yVal = 15, updateCount = 0;
	var total = 0;
    var updateChart = function () {
        var imageAddr = "https://github.com/Jeff-Manning/Jeff-Manning.github.io/blob/master/snake%20river.jpg?raw=true"; 
        var startTime, endTime;
        var downloadSize = 5245329;
        var download = new Image();

        startTime = new Date().getTime();
        var cacheBuster = "?nnn=" + startTime;
        download.src = imageAddr + cacheBuster;

        download.onload = function () {
            endTime = (new Date()).getTime();

            var duration = (endTime - startTime) / 1000;
            var bitsLoaded = downloadSize * 8;
            var speedBps =  (bitsLoaded / duration).toFixed(2);
            var speedKbps = (speedBps / 1024).toFixed(2);
            var speedMbps = (speedKbps / 1024).toFixed(2);

		    yVal = parseInt(speedMbps);
      	
            updateCount++;
            total = total + yVal;
            var average = total / updateCount;
		
            console.log(updateCount);

            document.getElementById('average').innerHTML = "Average: " + average.toFixed(2).toString() + " Mbps";   
            
		    dataPoints.push({ y : yVal });
      	
            chart.options.title.text = "Update " + updateCount;
		    chart.render();    
        }
	};

	// update chart every second
	setInterval(function(){updateChart()}, 1000);

}	
</script>
</head>
<body>
<div id="average">0</div>    
<div id = "chartContainer" style = "height: 300px; width: 100%;" />

</body>
</html>


// calculate packet loss
